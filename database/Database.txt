CREATE TABLE users (
    id VARCHAR(36) NOT NULL,
    email VARCHAR(255) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    user_type ENUM('donor', 'charity', 'admin') NOT NULL,
    first_name VARCHAR(100) NULL,
    last_name VARCHAR(100) NULL,
    phone VARCHAR(20) NULL,
    profile_image_url VARCHAR(500) NULL,
    email_verified BOOLEAN NOT NULL DEFAULT FALSE,
    email_verified_at TIMESTAMP NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    last_login_at TIMESTAMP NULL,
    password_reset_token VARCHAR(255) NULL,
    password_reset_expires TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_users_email (email),
    INDEX idx_users_type (user_type),
    INDEX idx_users_active (is_active),
    INDEX idx_users_created (created_at)
);


CREATE TABLE donors (
    id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    date_of_birth DATE NULL,
    address_line1 VARCHAR(255) NULL,
    address_line2 VARCHAR(255) NULL,
    city VARCHAR(100) NULL,
    state VARCHAR(100) NULL,
    postal_code VARCHAR(20) NULL,
    country VARCHAR(100) NOT NULL DEFAULT 'Philippines',
    preferred_payment_method ENUM('gcash', 'paymaya', 'card', 'bank') NULL,
    donation_frequency_preference ENUM('onetime', 'monthly', 'both') NOT NULL DEFAULT 'onetime',
    total_donated DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    donation_count INT NOT NULL DEFAULT 0,
    favorite_categories JSON NULL,
    notification_preferences JSON NULL,
    tax_receipt_required BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_donors_user (user_id),
    INDEX idx_donors_total_donated (total_donated),
    INDEX idx_donors_donation_count (donation_count),
    INDEX idx_donors_country (country),
    CONSTRAINT fk_donors_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);


CREATE TABLE charities (
    id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    organization_name VARCHAR(255) NOT NULL,
    organization_type ENUM('ngo', 'foundation', 'religious', 'educational', 'healthcare', 'community', 'other') NOT NULL,
    registration_number VARCHAR(100) NULL,
    tax_id VARCHAR(100) NULL,
    description TEXT NULL,
    mission_statement TEXT NULL,
    website_url VARCHAR(500) NULL,
    facebook_url VARCHAR(500) NULL,
    instagram_url VARCHAR(500) NULL,
    twitter_url VARCHAR(500) NULL,
    address_line1 VARCHAR(255) NULL,
    address_line2 VARCHAR(255) NULL,
    city VARCHAR(100) NULL,
    state VARCHAR(100) NULL,
    postal_code VARCHAR(20) NULL,
    country VARCHAR(100) NOT NULL DEFAULT 'Philippines',
    verification_status ENUM('pending', 'under_review', 'verified', 'rejected', 'suspended') NOT NULL DEFAULT 'pending',
    verification_date TIMESTAMP NULL,
    verified_by VARCHAR(36) NULL,
    rejection_reason TEXT NULL,
    bank_name VARCHAR(255) NULL,
    bank_account_holder VARCHAR(255) NULL,
    bank_account_number VARCHAR(100) NULL,
    bank_branch_code VARCHAR(50) NULL,
    bank_account_verified BOOLEAN NOT NULL DEFAULT FALSE,
    bank_verification_date TIMESTAMP NULL,
    total_raised DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    total_campaigns INT NOT NULL DEFAULT 0,
    active_campaigns INT NOT NULL DEFAULT 0,
    transparency_score INT NULL,
    efficiency_rating INT NULL,
    last_scorecard_update TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_charities_user (user_id),
    UNIQUE KEY uk_charities_registration (registration_number),
    INDEX idx_charities_name (organization_name),
    INDEX idx_charities_verification (verification_status),
    INDEX idx_charities_type (organization_type),
    INDEX idx_charities_total_raised (total_raised),
    INDEX idx_charities_transparency (transparency_score),
    CONSTRAINT fk_charities_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    CONSTRAINT fk_charities_verified_by FOREIGN KEY (verified_by) REFERENCES users(id) ON DELETE SET NULL
);


CREATE TABLE campaigns (
    id VARCHAR(36) NOT NULL,
    charity_id VARCHAR(36) NOT NULL,
    title VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    short_description VARCHAR(500) NULL,
    category VARCHAR(100) NOT NULL,
    subcategory VARCHAR(100) NULL,
    goal_amount DECIMAL(15,2) NOT NULL,
    raised_amount DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    held_amount DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    released_amount DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    image_url VARCHAR(500) NULL,
    banner_url VARCHAR(500) NULL,
    video_url VARCHAR(500) NULL,
    location VARCHAR(255) NULL,
    start_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    end_date TIMESTAMP NOT NULL,
    status ENUM('draft', 'pending_approval', 'active', 'paused', 'completed', 'cancelled', 'expired') NOT NULL DEFAULT 'draft',
    verification_status ENUM('pending', 'verified', 'rejected') NOT NULL DEFAULT 'pending',
    verified BOOLEAN NOT NULL DEFAULT FALSE,
    verified_by VARCHAR(36) NULL,
    verified_at TIMESTAMP NULL,
    rejection_reason TEXT NULL,
    featured BOOLEAN NOT NULL DEFAULT FALSE,
    urgent BOOLEAN NOT NULL DEFAULT FALSE,
    donor_count INT NOT NULL DEFAULT 0,
    view_count INT NOT NULL DEFAULT 0,
    share_count INT NOT NULL DEFAULT 0,
    tags JSON NULL,
    meta_title VARCHAR(255) NULL,
    meta_description VARCHAR(500) NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_campaigns_slug (slug),
    INDEX idx_campaigns_charity (charity_id),
    INDEX idx_campaigns_status (status),
    INDEX idx_campaigns_verification (verification_status),
    INDEX idx_campaigns_category (category),
    INDEX idx_campaigns_verified (verified),
    INDEX idx_campaigns_featured (featured),
    INDEX idx_campaigns_end_date (end_date),
    INDEX idx_campaigns_raised (raised_amount),
    INDEX idx_campaigns_created (created_at),
    CONSTRAINT fk_campaigns_charity FOREIGN KEY (charity_id) REFERENCES charities(id) ON DELETE CASCADE,
    CONSTRAINT fk_campaigns_verified_by FOREIGN KEY (verified_by) REFERENCES users(id) ON DELETE SET NULL
);


CREATE TABLE milestones (
    id VARCHAR(36) NOT NULL,
    campaign_id VARCHAR(36) NOT NULL,
    milestone_number INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    target_amount DECIMAL(15,2) NOT NULL,
    percentage_of_goal DECIMAL(5,2) NOT NULL,
    due_date TIMESTAMP NULL,
    requirements TEXT NULL,
    deliverables TEXT NULL,
    status ENUM('upcoming', 'pending', 'in_progress', 'submitted', 'under_review', 'verified', 'released', 'rejected') NOT NULL DEFAULT 'upcoming',
    proof_required BOOLEAN NOT NULL DEFAULT TRUE,
    proof_submitted BOOLEAN NOT NULL DEFAULT FALSE,
    proof_verified BOOLEAN NOT NULL DEFAULT FALSE,
    funds_released BOOLEAN NOT NULL DEFAULT FALSE,
    release_date TIMESTAMP NULL,
    verified_by VARCHAR(36) NULL,
    verified_at TIMESTAMP NULL,
    rejection_reason TEXT NULL,
    admin_notes TEXT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_milestones_campaign_number (campaign_id, milestone_number),
    INDEX idx_milestones_campaign (campaign_id),
    INDEX idx_milestones_status (status),
    INDEX idx_milestones_due_date (due_date),
    INDEX idx_milestones_proof_submitted (proof_submitted),
    INDEX idx_milestones_verified (proof_verified),
    CONSTRAINT fk_milestones_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE,
    CONSTRAINT fk_milestones_verified_by FOREIGN KEY (verified_by) REFERENCES users(id) ON DELETE SET NULL
);


CREATE TABLE milestone_proofs (
    id VARCHAR(36) NOT NULL,
    milestone_id VARCHAR(36) NOT NULL,
    proof_type ENUM('receipt', 'photo', 'video', 'report', 'document', 'testimonial', 'survey', 'other') NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    submission_notes TEXT NULL,
    submission_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    status ENUM('pending', 'under_review', 'approved', 'needs_revision', 'rejected') NOT NULL DEFAULT 'pending',
    reviewer_notes TEXT NULL,
    reviewed_by VARCHAR(36) NULL,
    reviewed_at TIMESTAMP NULL,
    revision_count INT NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_proof_milestone (milestone_id),
    INDEX idx_proof_status (status),
    INDEX idx_proof_type (proof_type),
    INDEX idx_proof_submission_date (submission_date),
    CONSTRAINT fk_proof_milestone FOREIGN KEY (milestone_id) REFERENCES milestones(id) ON DELETE CASCADE,
    CONSTRAINT fk_proof_reviewed_by FOREIGN KEY (reviewed_by) REFERENCES users(id) ON DELETE SET NULL
);


CREATE TABLE proof_files (
    id VARCHAR(36) NOT NULL,
    proof_id VARCHAR(36) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    original_name VARCHAR(255) NOT NULL,
    file_type ENUM('image', 'video', 'document', 'pdf', 'audio') NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    file_size_bytes BIGINT NOT NULL,
    file_size_mb DECIMAL(10,2) NOT NULL,
    file_url VARCHAR(500) NOT NULL,
    storage_path VARCHAR(500) NOT NULL,
    is_primary BOOLEAN NOT NULL DEFAULT FALSE,
    upload_status ENUM('uploading', 'completed', 'failed') NOT NULL DEFAULT 'completed',
    uploaded_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_files_proof (proof_id),
    INDEX idx_files_type (file_type),
    INDEX idx_files_primary (is_primary),
    CONSTRAINT fk_files_proof FOREIGN KEY (proof_id) REFERENCES milestone_proofs(id) ON DELETE CASCADE
);


CREATE TABLE donations (
    id VARCHAR(36) NOT NULL,
    donor_id VARCHAR(36) NOT NULL,
    campaign_id VARCHAR(36) NOT NULL,
    amount DECIMAL(15,2) NOT NULL,
    frequency ENUM('onetime', 'monthly') NOT NULL DEFAULT 'onetime',
    payment_method ENUM('gcash', 'paymaya', 'card', 'bank', 'other') NOT NULL,
    payment_reference VARCHAR(255) NULL,
    external_payment_id VARCHAR(255) NULL,
    payment_status ENUM('pending', 'processing', 'completed', 'failed', 'cancelled', 'refunded', 'disputed') NOT NULL DEFAULT 'pending',
    currency VARCHAR(3) NOT NULL DEFAULT 'PHP',
    exchange_rate DECIMAL(10,6) NULL,
    amount_usd DECIMAL(15,2) NULL,
    anonymous BOOLEAN NOT NULL DEFAULT FALSE,
    public_message TEXT NULL,
    private_message TEXT NULL,
    tribute_type ENUM('in_honor', 'in_memory', 'none') NOT NULL DEFAULT 'none',
    tribute_name VARCHAR(255) NULL,
    tribute_email VARCHAR(255) NULL,
    fee_amount DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    net_amount DECIMAL(15,2) NOT NULL,
    tax_deductible BOOLEAN NOT NULL DEFAULT TRUE,
    receipt_sent BOOLEAN NOT NULL DEFAULT FALSE,
    receipt_sent_at TIMESTAMP NULL,
    refund_reason TEXT NULL,
    refunded_at TIMESTAMP NULL,
    donation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_donations_payment_ref (payment_reference),
    INDEX idx_donations_donor (donor_id),
    INDEX idx_donations_campaign (campaign_id),
    INDEX idx_donations_status (payment_status),
    INDEX idx_donations_method (payment_method),
    INDEX idx_donations_date (donation_date),
    INDEX idx_donations_amount (amount),
    INDEX idx_donations_frequency (frequency),
    INDEX idx_donations_anonymous (anonymous),
    CONSTRAINT fk_donations_donor FOREIGN KEY (donor_id) REFERENCES donors(id) ON DELETE CASCADE,
    CONSTRAINT fk_donations_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE
);


CREATE TABLE recurring_donations (
    id VARCHAR(36) NOT NULL,
    donor_id VARCHAR(36) NOT NULL,
    campaign_id VARCHAR(36) NOT NULL,
    amount DECIMAL(15,2) NOT NULL,
    payment_method ENUM('gcash', 'paymaya', 'card', 'bank') NOT NULL,
    payment_token VARCHAR(255) NULL,
    status ENUM('active', 'paused', 'cancelled', 'failed', 'expired') NOT NULL DEFAULT 'active',
    start_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    next_charge_date TIMESTAMP NOT NULL,
    last_charged_at TIMESTAMP NULL,
    pause_until_date TIMESTAMP NULL,
    cancellation_reason TEXT NULL,
    cancelled_at TIMESTAMP NULL,
    total_charges INT NOT NULL DEFAULT 0,
    total_amount DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    failed_charge_count INT NOT NULL DEFAULT 0,
    last_failure_reason TEXT NULL,
    retry_count INT NOT NULL DEFAULT 0,
    max_retry_attempts INT NOT NULL DEFAULT 3,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_recurring_donor (donor_id),
    INDEX idx_recurring_campaign (campaign_id),
    INDEX idx_recurring_status (status),
    INDEX idx_recurring_next_charge (next_charge_date),
    INDEX idx_recurring_active (status, next_charge_date),
    CONSTRAINT fk_recurring_donor FOREIGN KEY (donor_id) REFERENCES donors(id) ON DELETE CASCADE,
    CONSTRAINT fk_recurring_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE
);


CREATE TABLE fund_releases (
    id VARCHAR(36) NOT NULL,
    milestone_id VARCHAR(36) NOT NULL,
    campaign_id VARCHAR(36) NOT NULL,
    charity_id VARCHAR(36) NOT NULL,
    release_type ENUM('milestone', 'emergency', 'final', 'partial') NOT NULL DEFAULT 'milestone',
    amount DECIMAL(15,2) NOT NULL,
    fee_amount DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    net_amount DECIMAL(15,2) NOT NULL,
    bank_name VARCHAR(255) NOT NULL,
    bank_account_number VARCHAR(100) NOT NULL,
    bank_reference VARCHAR(255) NULL,
    transaction_reference VARCHAR(255) NULL,
    status ENUM('pending_approval', 'approved', 'processing', 'completed', 'failed', 'cancelled') NOT NULL DEFAULT 'pending_approval',
    approved_by VARCHAR(36) NULL,
    approved_at TIMESTAMP NULL,
    processed_by VARCHAR(36) NULL,
    processed_at TIMESTAMP NULL,
    release_date TIMESTAMP NULL,
    failure_reason TEXT NULL,
    admin_notes TEXT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_releases_milestone (milestone_id),
    INDEX idx_releases_campaign (campaign_id),
    INDEX idx_releases_charity (charity_id),
    INDEX idx_releases_status (status),
    INDEX idx_releases_date (release_date),
    INDEX idx_releases_amount (amount),
    CONSTRAINT fk_releases_milestone FOREIGN KEY (milestone_id) REFERENCES milestones(id) ON DELETE CASCADE,
    CONSTRAINT fk_releases_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE,
    CONSTRAINT fk_releases_charity FOREIGN KEY (charity_id) REFERENCES charities(id) ON DELETE CASCADE,
    CONSTRAINT fk_releases_approved_by FOREIGN KEY (approved_by) REFERENCES users(id) ON DELETE SET NULL,
    CONSTRAINT fk_releases_processed_by FOREIGN KEY (processed_by) REFERENCES users(id) ON DELETE SET NULL
);


CREATE TABLE impact_updates (
    id VARCHAR(36) NOT NULL,
    campaign_id VARCHAR(36) NOT NULL,
    milestone_id VARCHAR(36) NULL,
    author_id VARCHAR(36) NOT NULL,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    summary VARCHAR(500) NULL,
    image_url VARCHAR(500) NULL,
    video_url VARCHAR(500) NULL,
    update_type ENUM('progress', 'milestone', 'story', 'emergency', 'completion') NOT NULL DEFAULT 'progress',
    is_published BOOLEAN NOT NULL DEFAULT FALSE,
    published_at TIMESTAMP NULL,
    scheduled_publish_at TIMESTAMP NULL,
    view_count INT NOT NULL DEFAULT 0,
    like_count INT NOT NULL DEFAULT 0,
    share_count INT NOT NULL DEFAULT 0,
    featured BOOLEAN NOT NULL DEFAULT FALSE,
    tags JSON NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_updates_campaign (campaign_id),
    INDEX idx_updates_milestone (milestone_id),
    INDEX idx_updates_author (author_id),
    INDEX idx_updates_published (is_published, published_at),
    INDEX idx_updates_type (update_type),
    INDEX idx_updates_featured (featured),
    CONSTRAINT fk_updates_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE,
    CONSTRAINT fk_updates_milestone FOREIGN KEY (milestone_id) REFERENCES milestones(id) ON DELETE SET NULL,
    CONSTRAINT fk_updates_author FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE
);


CREATE TABLE impact_metrics (
    id VARCHAR(36) NOT NULL,
    campaign_id VARCHAR(36) NOT NULL,
    update_id VARCHAR(36) NULL,
    metric_type VARCHAR(100) NOT NULL,
    metric_category ENUM('beneficiaries', 'output', 'outcome', 'impact', 'efficiency') NOT NULL,
    metric_name VARCHAR(255) NOT NULL,
    metric_value DECIMAL(15,2) NOT NULL,
    metric_unit VARCHAR(50) NULL,
    metric_description TEXT NULL,
    measurement_date TIMESTAMP NOT NULL,
    data_source VARCHAR(255) NULL,
    verification_status ENUM('unverified', 'self_reported', 'third_party', 'verified') NOT NULL DEFAULT 'self_reported',
    baseline_value DECIMAL(15,2) NULL,
    target_value DECIMAL(15,2) NULL,
    is_cumulative BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_metrics_campaign (campaign_id),
    INDEX idx_metrics_update (update_id),
    INDEX idx_metrics_type (metric_type),
    INDEX idx_metrics_category (metric_category),
    INDEX idx_metrics_date (measurement_date),
    CONSTRAINT fk_metrics_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE,
    CONSTRAINT fk_metrics_update FOREIGN KEY (update_id) REFERENCES impact_updates(id) ON DELETE SET NULL
);


CREATE TABLE notifications (
    id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    notification_type VARCHAR(50) NOT NULL,
    category ENUM('donation', 'campaign', 'milestone', 'verification', 'system', 'marketing') NOT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    action_text VARCHAR(100) NULL,
    action_url VARCHAR(500) NULL,
    priority ENUM('low', 'normal', 'high', 'urgent') NOT NULL DEFAULT 'normal',
    delivery_method ENUM('in_app', 'email', 'sms', 'push') NOT NULL DEFAULT 'in_app',
    is_read BOOLEAN NOT NULL DEFAULT FALSE,
    read_at TIMESTAMP NULL,
    is_sent BOOLEAN NOT NULL DEFAULT FALSE,
    sent_at TIMESTAMP NULL,
    scheduled_for TIMESTAMP NULL,
    related_entity_type VARCHAR(50) NULL,
    related_entity_id VARCHAR(36) NULL,
    metadata JSON NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_notifications_user (user_id),
    INDEX idx_notifications_unread (user_id, is_read),
    INDEX idx_notifications_type (notification_type),
    INDEX idx_notifications_category (category),
    INDEX idx_notifications_scheduled (scheduled_for),
    INDEX idx_notifications_entity (related_entity_type, related_entity_id),
    CONSTRAINT fk_notifications_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);


CREATE TABLE audit_logs (
    id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NULL,
    session_id VARCHAR(36) NULL,
    action VARCHAR(100) NOT NULL,
    entity_type VARCHAR(50) NOT NULL,
    entity_id VARCHAR(36) NULL,
    description TEXT NULL,
    old_values JSON NULL,
    new_values JSON NULL,
    changes_summary TEXT NULL,
    ip_address VARCHAR(45) NULL,
    user_agent TEXT NULL,
    request_id VARCHAR(36) NULL,
    severity ENUM('info', 'warning', 'error', 'critical') NOT NULL DEFAULT 'info',
    status ENUM('success', 'failure', 'pending') NOT NULL DEFAULT 'success',
    error_message TEXT NULL,
    execution_time_ms INT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_audit_user (user_id),
    INDEX idx_audit_action (action),
    INDEX idx_audit_entity (entity_type, entity_id),
    INDEX idx_audit_date (created_at),
    INDEX idx_audit_severity (severity),
    INDEX idx_audit_ip (ip_address),
    CONSTRAINT fk_audit_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);


CREATE TABLE admin_scorecards (
    id VARCHAR(36) NOT NULL,
    charity_id VARCHAR(36) NOT NULL,
    scorecard_period VARCHAR(20) NOT NULL,
    transparency_score INT NOT NULL DEFAULT 0,
    efficiency_score INT NOT NULL DEFAULT 0,
    impact_score INT NOT NULL DEFAULT 0,
    overall_score INT NOT NULL DEFAULT 0,
    funds_utilization_rate DECIMAL(5,2) NOT NULL DEFAULT 0.00,
    milestone_completion_rate DECIMAL(5,2) NOT NULL DEFAULT 0.00,
    donor_satisfaction_score INT NULL,
    report_timeliness_score INT NOT NULL DEFAULT 0,
    compliance_score INT NOT NULL DEFAULT 0,
    total_campaigns INT NOT NULL DEFAULT 0,
    successful_campaigns INT NOT NULL DEFAULT 0,
    total_funds_raised DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    total_funds_released DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    verification_issues_count INT NOT NULL DEFAULT 0,
    last_calculated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    calculated_by VARCHAR(36) NOT NULL,
    notes TEXT NULL,
    is_published BOOLEAN NOT NULL DEFAULT FALSE,
    published_at TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_scorecards_charity_period (charity_id, scorecard_period),
    INDEX idx_scorecards_charity (charity_id),
    INDEX idx_scorecards_overall (overall_score),
    INDEX idx_scorecards_transparency (transparency_score),
    INDEX idx_scorecards_period (scorecard_period),
    INDEX idx_scorecards_published (is_published),
    CONSTRAINT fk_scorecards_charity FOREIGN KEY (charity_id) REFERENCES charities(id) ON DELETE CASCADE,
    CONSTRAINT fk_scorecards_calculated_by FOREIGN KEY (calculated_by) REFERENCES users(id) ON DELETE RESTRICT
);


CREATE TABLE platform_settings (
    id VARCHAR(36) NOT NULL,
    setting_key VARCHAR(100) NOT NULL,
    setting_value TEXT NULL,
    setting_type ENUM('string', 'number', 'boolean', 'json', 'encrypted') NOT NULL DEFAULT 'string',
    category VARCHAR(50) NOT NULL,
    description TEXT NULL,
    is_public BOOLEAN NOT NULL DEFAULT FALSE,
    is_editable BOOLEAN NOT NULL DEFAULT TRUE,
    validation_rules JSON NULL,
    default_value TEXT NULL,
    last_modified_by VARCHAR(36) NOT NULL,
    version INT NOT NULL DEFAULT 1,
    effective_from TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    effective_until TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_settings_key (setting_key),
    INDEX idx_settings_category (category),
    INDEX idx_settings_public (is_public),
    INDEX idx_settings_effective (effective_from, effective_until),
    CONSTRAINT fk_settings_modified_by FOREIGN KEY (last_modified_by) REFERENCES users(id) ON DELETE RESTRICT
);


CREATE TABLE campaign_comments (
    id VARCHAR(36) NOT NULL,
    campaign_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    parent_comment_id VARCHAR(36) NULL,
    content TEXT NOT NULL,
    is_anonymous BOOLEAN NOT NULL DEFAULT FALSE,
    is_approved BOOLEAN NOT NULL DEFAULT FALSE,
    is_flagged BOOLEAN NOT NULL DEFAULT FALSE,
    flag_reason VARCHAR(255) NULL,
    moderated_by VARCHAR(36) NULL,
    moderated_at TIMESTAMP NULL,
    like_count INT NOT NULL DEFAULT 0,
    reply_count INT NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (id),
    INDEX idx_comments_campaign (campaign_id),
    INDEX idx_comments_user (user_id),
    INDEX idx_comments_parent (parent_comment_id),
    INDEX idx_comments_approved (is_approved),
    INDEX idx_comments_flagged (is_flagged),
    INDEX idx_comments_created (created_at),
    CONSTRAINT fk_comments_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE,
    CONSTRAINT fk_comments_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    CONSTRAINT fk_comments_parent FOREIGN KEY (parent_comment_id) REFERENCES campaign_comments(id) ON DELETE CASCADE,
    CONSTRAINT fk_comments_moderated_by FOREIGN KEY (moderated_by) REFERENCES users(id) ON DELETE SET NULL
);


